## 周志明的软件架构课

如何构建一个可靠的分布式系统

https://icyfenix.cn/introduction/about-me.html

## 00 intro

架构演变最重要的驱动力，或者说产生这种“从大到小”趋势的最根本的驱动力，始终都是为了方便某个服务能够顺利地“死去”与“重生”而设计的

(微服务就像细胞，单个节点的消亡不会影响系统整体的稳定性)

## 01 | 原始分布式时代：Unix设计哲学下的服务探索

原始分布式时代提出的构建“符合 Unix 的设计哲学的”，以及“如同本地调用一般简单透明的”分布式系统的这个目标

远程调用

- 问题:

远程的服务在哪里（服务发现）

有多少个（负载均衡）

网络出现分区、超时或者服务出错了怎么办（熔断、隔离、降级）

方法的参数与返回结果如何表示（序列化协议）

如何传输（传输协议）

服务权限如何管理（认证、授权）

如何保证通信安全（网络安全层）

如何令调用不同机器的服务能返回相同的结果（分布式数据一致性）

**把一个系统直接拆分到不同的机器之中，这样做带来的服务的发现、跟踪、通讯、容错、隔离、配置、传输、数据一致性和编码复杂度等方面的问题**

### 原始分布式时代的教训

Just because something can be distributed doesn’t mean it should be distributed. Trying to make a distributed call act like a local call always ends in tears.

## 02 | 单体系统时代：应用最广泛的架构风格

优点 : 易于分层、易于开发、易于部署测试、进程内的高效交互

### 大型单体系统

巨石系统

单体系统并不是反派

不需要 进程间通讯：Inter-Process Communication，IPC。(RPC 属于 IPC 的一种特例)

单体系统的 纵向/横向 拆分(拓展) 

### 非独立的单体

单体系统的真正缺陷实际上并不在于要如何拆分，而在于拆分之后，它会存在隔离与自治能力上的欠缺

在单体架构中，所有的代码都运行在同一个进程空间之内，所有模块、方法的调用也都不需要考虑网络分区、对象复制这些麻烦事儿，也不担心因为数据交换而造成性能的损失

可是，在获得了进程内调用的简单、高效这些好处的同时，也就意味着，如果在单体架构中，有任何一部分的代码出现了缺陷，过度消耗进程空间内的公共资源，那所造成的影响就是全局性的、难以隔离的。

由于隔离能力的缺失，除了会带来难以阻断错误传播、不便于动态更新程序的问题，还会给带来难以技术异构等困难。

- 技术异构 : 允许系统的每个模块，自由选择不一样的程序语言、不一样的编程框架等技术栈去实现。

即使是为了允许程序出错，为了获得隔离、自治的能力，为了可以技术异构等目标，也并不意味着一定要依靠微服务架构

## SOA时代：成功理论与失败实践

在新旧世纪之交，人们曾经探索过几种服务的拆分方法，把一个大的单体系统拆分为若干个更小的、不运行在同一个进程的独立服务，这些服务拆分的方法，后来导致了面向服务架构（Service-Oriented Architecture）的一段兴盛期，我们把它称作是“SOA 时代”。

### 三种代表性的服务拆分架构模式

1. 烟囱式架构（Information Silo Architecture）

这种信息系统，完全不会跟其他相关的信息系统之间进行互操作，或者是进行协调工作。

2. 微内核架构（Microkernel Architecture）

插件式架构（Plug-in Architecture）。

主数据，公共服务、数据、资源，都集中到一块，成为一个被所有业务系统共同依赖的核心系统（Kernel，也称为 Core System）。

具体的业务系统就能以插件模块（Plug-in Modules）的形式存在了，就可以为整个系统提供可扩展的、灵活的、天然隔离的功能特性

适合实现一个能够支持二次开发的软件系统

- 局限/使用前提

假设系统中各个插件模块之间是互不认识的（不可预知系统会安装哪些模块），这些插件会访问内核中一些公共的资源，但不会发生直接交互。

3. 事件驱动架构（Event-Driven Architecture）

为了能让子系统之间互相通讯

在子系统之间建立一套事件队列管道（Event Queues），来自系统外部的消息将以事件的形式发送到管道中

https://www.zhihu.com/question/42061683


## 04 | 微服务时代：SOA的革命者

微服务是一种通过多个小型服务的组合，来构建单个应用的架构风格

各个服务可以采用不同的编程语言、不同的数据存储技术、运行在不同的进程之中。

服务会采取轻量级的通讯机制和自动化的部署机制，来实现通讯与运维。

1. 围绕业务能力构建（Organized around Business Capabilities）

2. 分散治理（Decentralized Governance）

3. 通过服务来实现独立自治的组件（Componentization via Services）

4. 产品化思维（Products not Projects）

5. 数据去中心化（Decentralized Data Management）

6. 轻量级通讯机制（Smart Endpoints and Dumb Pipes）

7. 容错性设计（Design for Failure）

8. 演进式设计（Evolutionary Design）

9. 基础设施自动化（Infrastructure Automation）

## 05 | 后微服务时代：跨越软件与硬件之间的界限



